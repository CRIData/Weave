<CustomTree xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:ui="weave.ui.*"
    xmlns="weave.ui.*"
    creationComplete="handleCreationComplete()"
    openDuration="0" dragEnabled="true"
	allowMultipleSelection="true"
    showRoot="false">
	<mx:Script>
		<![CDATA[
			import mx.binding.utils.BindingUtils;
			
			import weave.api.getCallbackCollection;
			import weave.services.Admin;
			import weave.utils.EventUtils;
			
			public function set rootFilterType(type:int):void
			{
				dataProvider = _rootNode = new EntityNode(type);
				dataDescriptor = new EntityTreeDataDescriptor();
				nodeFilterFunction = _nodeFilterFunction;
			}
			
			private var _nodeFilterFunction:Function;
			private var _rootNode:EntityNode;
			
			public function set nodeFilterFunction(filter:Function):void
			{
				if (_rootNode)
					_rootNode.children.filterFunction = filter;
				else
					_nodeFilterFunction = filter;
			}
			
			private function handleCreationComplete():void
			{
				getCallbackCollection(Admin.entityCache).addImmediateCallback(this, delayedRefresh);
				BindingUtils.bindSetter(connectionReady, Admin.instance, 'userHasAuthenticated');
			}
			
			private function connectionReady(userHasAuthenticated:Boolean):void
			{
			    if (userHasAuthenticated == true)
					refreshDataProvider();
			}
			
			private const delayedRefresh:Function = EventUtils.generateDelayedCallback(this, refresh, 100);
			
			public function refresh():void
			{
				// Because we are not rendering the root node, we need to explicitly request the children from
				// the root so that the children will be fetched.
				if (_rootNode)
					_rootNode.children.refresh();
				
				refreshDataProvider();
			}
		]]>
	</mx:Script>
</CustomTree>
