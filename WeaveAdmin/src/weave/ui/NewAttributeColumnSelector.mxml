<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml"
                xmlns:ui="weave.ui.*"
                width="100%" height="100%"
                xmlns="weave.ui.*"
                label="Attribute Column Selection"
                creationComplete="handleCreationComplete()">
    <mx:HDividedBox id="selectorBox" width="100%" height="100%">
        <mx:VBox id="groupBox" height="100%" width="100%">
            <mx:ComboBox id="modeCombo" height="20" change="onComboSelect">
            </mx:ComboBox>
            <mx:Tree height="100%" width="100%" id="tagtableTree"/>
        </mx:VBox>
        <mx:VBox id="columnBox" height="100%" width="100%">
            <mx:Label text="Attribute Columns" height="20"/>
            <mx:List height="100%" width="100%" id="columnList"/>
        </mx:VBox>
    </mx:HDividedBox>
    <mx:HBox id="searchBox" width="100%">
        <mx:TextInput width="75%" id="searchInput"/>
        <mx:ComboBox width="15%" id="metaCombo">
        </mx:ComboBox>
        <mx:Button width="10%" label="Search" id="searchButton"/>
    </mx:HBox>
    <mx:HBox id="editorBox" width="100%" visible="false">
        <mx:Button label="Add Tag"/>
        <mx:Button label="Delete Tag"/>
    </mx:HBox>
<mx:Script>
<![CDATA[
    import mx.binding.utils.BindingUtils;
    import mx.events.ListEvent;
    import mx.events.TreeEvent;
    import mx.rpc.events.ResultEvent;
    import weave.services.AdminInterface;
    import weave.services.beans.AttributeColumnInfo;
    import weave.ui.EntityTreeNode;

    public var adminService:AdminInterface
    [Bindable] public var selectedItem:Object;

    private var tagTree:Array;
    private var dataTables:Array;

    private var entitiesById:Object;
    private var expandList:Array;

    public function handleCreationComplete():void
    {
        var comboArray:Array = new Array("Tags","Tables");
        modeCombo.dataProvider = comboArray;
         
        return;
    }
    public function populateRoot(onFinish:Function=null):void
    {
        function populateRootHandler(event:ResultEvent, token:Object = null):void
        {
            var entities:Array = event.result as Array || [];
            for each (var entity:AttributeColumnInfo in entities)
            {
                if (entity.entity_type == 2)
                    tagTree.push(new EntityTreeNode(entity));
                else if (entity.entity_type == 0)
                    dataTables.push(new EntityTreeNode(entity));
            }
            if (onFinish != null)
            {
                onFinish();
            }
        }
        AdminInterface.instance.findEntitiesByParent(-1, populateRootHandler);
    }
    private function frobProvider():void
    {
        var old:Object = tagtableTree.dataProvider;
        tagtableTree.dataProvider = null;
        tagtableTree.dataProvider = old;
        
        old = columnList.dataProvider;
        columnList.dataProvider = null;
        columnList.dataProvider = old;
    }
    private function onComboSelect(event:ListEvent):void
    {
        if (tagTree == null) tagTree = new Array();
        populateRoot(this.frobProvider);
    }
    private function onGroupSelect(event:ListEvent):void
    {
        event.target.selectedItem.object;
    }
    private function onColumnSelect(event:ListEvent):void
    {
        selectedItem = event.target.selectedItem.object;
    }
    
]]>
</mx:Script>
</mx:VBox>
